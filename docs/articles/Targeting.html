<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Proxy-Means Testing for Assistance Targeting in Guatemala • AmericasBarometer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Proxy-Means Testing for Assistance Targeting in Guatemala">
<meta property="og:description" content="AmericasBarometer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AmericasBarometer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Survey_wave_content.html">Survey wave content</a>
    </li>
    <li>
      <a href="../articles/Crunch-report.html">Crunching Report</a>
    </li>
    <li>
      <a href="../articles/Root_Causes.html">Root Causes</a>
    </li>
    <li>
      <a href="../articles/Trends_per_year_by_topic.html">Trends per year by topic</a>
    </li>
    <li>
      <a href="../articles/Explaining_Intention_Migrate.html">Explaining_Intention_Migrate</a>
    </li>
    <li>
      <a href="../articles/Explaining_fear_being_victim.html">Explaining_fear_being_victim</a>
    </li>
    <li>
      <a href="../articles/Explaining_risk_bribes.html">Explaining_risk_bribes</a>
    </li>
    <li>
      <a href="../articles/Building_indices.html">Building indices</a>
    </li>
    <li>
      <a href="../articles/Profiling_Intended_Migrant.html">Profiling Intended Migrant</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/unhcr-americas/LAPOP-SMA/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Targeting_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Proxy-Means Testing for Assistance Targeting in Guatemala</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/unhcr-americas/LAPOP-SMA/blob/master/vignettes/Targeting.Rmd"><code>vignettes/Targeting.Rmd</code></a></small>
      <div class="hidden name"><code>Targeting.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><em>add some background on the scale-up in guatemala here</em>.</p>
</div>
<div id="background-to-proxy-means-testing-pmt" class="section level1">
<h1 class="hasAnchor">
<a href="#background-to-proxy-means-testing-pmt" class="anchor"></a>Background to Proxy-Means Testing (PMT)</h1>
<p>The targeting of assistance in humanitarian settings has traditionally relied on various approaches that are lacking in theoretical justification and rigorous validation such as targeting based on categorical profiles (older people, persons with disabilities, etc…), community-assisted targeting which is susceptible to elite capture, geographic targeting, and ad hoc scorecards among others.</p>
<p>Proxy-means testing, on the other hand, is a statistically-sound approach grounded in regression analysis which has gained a strong following among development practitioners.</p>
<p>In PMTs, vulnerability is assumed to be a directly measurable construct such as per-capita household income or expenditure and a statistical model is built to estimate this measure based on easily observable household characteristics (like location, the household’s demographic composition, and ownership of common assets). Uptake of PMTs in humanitarian contexts in the past was held back by the shortage of household survey data with sufficient covariates and detailed measures of income/expenditure to allow for constructing these kinds of models. The recent drive for surveys on forcibly displaced populations over the past few years, however, is slowly changing the data landscape in a way that makes it increasingly feasible to transition from ad hoc targeting approaches to more rigorous alternatives like PMTs.</p>
</div>
<div id="methodical-limitations" class="section level1">
<h1 class="hasAnchor">
<a href="#methodical-limitations" class="anchor"></a>Methodical Limitations</h1>
<p>The biggest challenge facing the construction of a PMT for Guatemala is the absence of a recent poverty survey, where <a href="https://www.ine.gob.gt/ine/pobreza-menu/">the last one dates to 2014</a>. As such, the second-best option was to use data from the <a href="https://www.vanderbilt.edu/lapop/">Latin America Public Opinion Poll Project (LAPOP)’s AmericasBarometer survey</a> for building the model. While the survey was not designed as a household budget survey to capture detailed household income/expenditure data, it remains the only up-to-date nationally representative household survey in Guatemala.</p>
<p>Downsides to using this dataset for building a PMT:</p>
<ul>
<li>The survey tool asks a one-shot question about overall household monthly income. This is known to result in less accurate estimates than when respondents are asked for detailed breakdowns by income source.</li>
<li>The survey samples a random adult from the household so that the results could be generalized to the overall adult population in the country. Considering the random selection of respondents, the selected individual may not be the best-informed person to respond to the questoin on overall household income.</li>
<li>Moreover, since the survey does not collect household roster data or information on a reference person, individual level variables (such as the head of household’s age, gender, and marital status or even the average age or education level of household members) couldn’t be used when constructing the model thereby weakening its explanatory power.</li>
<li>Similarly, as the survey was originally designed to measure political attitudes and opinions, it is limited in terms of covariates that could be used to explain household welfare.</li>
<li>Finally, because the sample size is restricted to about 1,500 respondents per country, that limits the applicable modeling techniques to simple linear models while excluding more data-hungry algorithmic modeling approaches like random forests and gradient boosting.</li>
</ul>
<p>Nonetheless, despite these challenges, the performance of the model so constructed from this dataset was reasonably satisfactory enough to warrant further consideration.</p>
<div id="preparing-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-the-data" class="anchor"></a>Preparing the data</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://unhcr-americas.github.io/LAPOP-SMA/docs">AmericasBarometer</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://embed.tidymodels.org">embed</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Read data from the AmericasBarometer</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html">read_dta</a></span><span class="op">(</span><span class="st">"http://datasets.americasbarometer.org/database/files/Guatemala%20LAPOP%20AmericasBarometer%202019%20v1.0_W.dta"</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> 
  <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="co"># Convert coded responses into human-readable labels</span>
  <span class="fu"><a href="https://haven.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># Replace variables indicating missingness with actual NAs</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span>, <span class="op">~</span><span class="fu">na_if</span><span class="op">(</span><span class="va">.</span>, <span class="st">"No sabe"</span><span class="op">)</span><span class="op">)</span>, 
         <span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span>, <span class="op">~</span><span class="fu">na_if</span><span class="op">(</span><span class="va">.</span>, <span class="st">"No responde"</span><span class="op">)</span><span class="op">)</span>,
         <span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span>, <span class="op">~</span><span class="fu">na_if</span><span class="op">(</span><span class="va">.</span>, <span class="st">"No Aplica"</span><span class="op">)</span><span class="op">)</span>,
         <span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span>, <span class="va">fct_drop</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># inverse of the Box-Cox transform</span>
<span class="va">invBoxCox</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">lambda</span><span class="op">)</span> <span class="op">{</span> <span class="kw">if</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">else</span> <span class="op">(</span><span class="va">lambda</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">lambda</span><span class="op">)</span> <span class="op">}</span>

<span class="co"># utility function to extract the best cutoff threshold from a regression model for a given poverty line</span>
<span class="va">optimum_threshold</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.x</span>, <span class="va">truth</span>, <span class="va">estimate</span>, <span class="va">cutoff</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">.x</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>poor <span class="op">=</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">truth</span><span class="op">}</span><span class="op">}</span> <span class="op">&lt;</span> <span class="op">{</span><span class="op">{</span><span class="va">cutoff</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">roc_curve</span><span class="op">(</span><span class="va">poor</span>, <span class="op">{</span><span class="op">{</span><span class="va">estimate</span><span class="op">}</span><span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">sensitivity</span><span class="op">+</span><span class="va">specificity</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mdata</span> <span class="op">&lt;-</span> 
  <span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu">transmute</span><span class="op">(</span><span class="co"># area-level variables</span>
            region <span class="op">=</span> <span class="va">estratopri</span>,
            province <span class="op">=</span> <span class="va">prov</span>,
            urban <span class="op">=</span> <span class="va">ur</span> <span class="op">==</span> <span class="st">"Urbano"</span>,
            <span class="co"># Create a binary variable indicating if the household lives in a secure neighborhood or not</span>
            secure_neighborhood <span class="op">=</span> <span class="fu">str_detect</span><span class="op">(</span><span class="va">aoj11</span>, <span class="st">"inseguro"</span>, negate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            <span class="co"># household composition</span>
            hhsize <span class="op">=</span> <span class="fu">fct_recode</span><span class="op">(</span><span class="va">q12c</span>, <span class="st">"20"</span> <span class="op">=</span> <span class="st">"20+"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,
            nchildren <span class="op">=</span> <span class="fu">fct_recode</span><span class="op">(</span><span class="va">q12bn</span>, <span class="st">"0"</span> <span class="op">=</span> <span class="st">"Ninguno"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,
            <span class="co"># fix incorrect entries where the reported number of children is greater than the household size</span>
            hhsize <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">hhsize</span> <span class="op">&lt;=</span> <span class="va">nchildren</span>, <span class="va">hhsize</span><span class="op">+</span><span class="va">nchildren</span>, <span class="va">hhsize</span><span class="op">)</span>,
            ethnicity <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">etid</span>, <span class="st">"Otra"</span>, after <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
            <span class="co"># household assets</span>
            refrigerator <span class="op">=</span> <span class="va">r3</span> <span class="op">==</span> <span class="st">"Sí"</span>,
            mobile <span class="op">=</span> <span class="va">r4a</span> <span class="op">==</span> <span class="st">"Sí"</span>,
            vehicle <span class="op">=</span> <span class="va">r5</span> <span class="op">!=</span> <span class="st">"No"</span>,
            washing_machine <span class="op">=</span> <span class="va">r6</span> <span class="op">==</span> <span class="st">"Sí"</span>,
            microwave <span class="op">=</span> <span class="va">r7</span> <span class="op">==</span> <span class="st">"Sí"</span>,
            motorcycle <span class="op">=</span> <span class="va">r8</span> <span class="op">==</span> <span class="st">"Sí"</span>,
            water <span class="op">=</span> <span class="va">r12</span> <span class="op">==</span> <span class="st">"Sí"</span>,
            sanitation <span class="op">=</span> <span class="va">r14</span> <span class="op">==</span> <span class="st">"Sí"</span>,
            computer <span class="op">=</span> <span class="va">r15</span> <span class="op">==</span> <span class="st">"Sí"</span>,
            internet <span class="op">=</span> <span class="va">r18</span> <span class="op">==</span> <span class="st">"Sí"</span>,
            tv <span class="op">=</span> <span class="va">r1</span> <span class="op">==</span> <span class="st">"Sí"</span>,
            <span class="co"># target variable</span>
            pcinc <span class="op">=</span> 
              <span class="fu">case_when</span><span class="op">(</span><span class="va">q10new</span> <span class="op">==</span> <span class="st">"Ningún ingreso"</span> <span class="op">~</span> <span class="cn">NA_real_</span>, <span class="co"># delete zero-income observations</span>
                        <span class="va">q10new</span> <span class="op">==</span> <span class="st">"Menos de 240 quetzales"</span> <span class="op">~</span> <span class="fl">120</span>, <span class="co"># bottom-code responses</span>
                        <span class="va">q10new</span> <span class="op">==</span> <span class="st">"Más de 5,500 quetzales"</span> <span class="op">~</span> <span class="fl">6000</span>, <span class="co"># top-code responses</span>
                        <span class="cn">TRUE</span> <span class="op">~</span> 
                          <span class="co"># otherwise, parse the range quoted (i.e. "earning between X &amp; Y quetzales")</span>
                          <span class="co"># and use the mid-point as the estimated household income</span>
                          <span class="fu">str_match</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">q10new</span><span class="op">)</span>, <span class="st">"Entre (.+) y (.+) quetzales"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
                          <span class="op">{</span><span class="op">(</span><span class="fu">parse_number</span><span class="op">(</span><span class="va">.</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="fu">parse_number</span><span class="op">(</span><span class="va">.</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">}</span><span class="op">)</span>,
            <span class="co"># divide by household size to convert to per-capita income</span>
            pcinc <span class="op">=</span> <span class="va">pcinc</span><span class="op">/</span><span class="va">hhsize</span><span class="op">)</span>

<span class="co"># remove observations with missing income data</span>
<span class="va">mdata</span> <span class="op">&lt;-</span> <span class="va">mdata</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">pcinc</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="model-diagnostics" class="section level1">
<h1 class="hasAnchor">
<a href="#model-diagnostics" class="anchor"></a>Model &amp; Diagnostics</h1>
<p>Survey respondents were asked to report aggregate household income through a multiple-choice question where they had to choose from one of 17 staggered income brackets. Respondents who declined to answer the question, or who said that they didn’t know the answer, as well as those who reported zero income were all removed from the sample. Of the 1596 respondents in the sample, only 1308 were retained for modeling purposes after removing the aforementioned respondents.</p>
<p>The below plot shows the distribution of household income per capita in the retained sample:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mdata</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">pcinc</span><span class="op">)</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#0072BC"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">label_percent</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Log(per capita income)"</span>, y <span class="op">=</span> <span class="st">"density"</span>,
       title <span class="op">=</span> <span class="st">"Distribution of household income per capita"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: AmericasBarometer - Guatemala, 2019"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Lato"</span><span class="op">)</span></code></pre></div>
<p><img src="Targeting_files/figure-html/pcinc-plot-1.png" width="660" style="display: block; margin: auto;"></p>
<p>As could be seen from the plot, the data shows a right-skew that violates the normality assumption of linear models. To overcome this issue, we’ll apply the Box-Cox transformation to make the outcome measure slightly more normal.</p>
<p>The following plot illustrates the variables that entered the model and their impact on the model’s predictions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># build a recipe to prepare data for modelling</span>
<span class="va">rec</span> <span class="op">&lt;-</span> 
  <span class="va">mdata</span> <span class="op">%&gt;%</span> 
  <span class="fu">recipe</span><span class="op">(</span><span class="va">pcinc</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># the BoxCox is a power-transformation similar to the logarithm that makes long-tailed data look a bit more normal</span>
  <span class="co"># after testing plain logarithm transformations and the shifted-logarithm, the Box-Cox showed the best performance </span>
  <span class="co"># so that's what we're using here</span>
  <span class="fu">step_BoxCox</span><span class="op">(</span><span class="va">pcinc</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># convert logicals into 0/1 variables - makes for more readable variable labels when plotting</span>
  <span class="fu">step_mutate_at</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.logical</span><span class="op">)</span>, fn <span class="op">=</span> <span class="va">as.numeric</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># use bagged trees to impute missing values in the predictors</span>
  <span class="fu">step_impute_bag</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># target-encode province (too many levels) using emperical bayes procedure</span>
  <span class="fu"><a href="https://embed.tidymodels.org/reference/step_lencode_mixed.html">step_lencode_mixed</a></span><span class="op">(</span><span class="va">province</span>, outcome <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">pcinc</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># create an interaction term that captures the dependency ratio in the household</span>
  <span class="fu">step_interact</span><span class="op">(</span><span class="op">~</span><span class="va">hhsize</span><span class="op">:</span><span class="va">nchildren</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># dummy-encode factor variables for modelling</span>
  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">prep</span><span class="op">(</span><span class="op">)</span>

<span class="co"># fits a linear model to the data after being processed thru the recipe</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">pcinc</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">rec</span> <span class="op">%&gt;%</span> <span class="fu">juice</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># convert model into tidy format</span>
<span class="va">tidym</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">m</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># remove the intercept term</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">!=</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co"># create "categories" grouping together related variables</span>
  <span class="fu">mutate</span><span class="op">(</span>category <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">term</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mdata</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">region</span><span class="op">:</span><span class="va">secure_neighborhood</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Area-level indicators"</span>,
                              <span class="fu">str_detect</span><span class="op">(</span><span class="va">term</span>, <span class="st">"region"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Area-level indicators"</span>,
                              <span class="va">term</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mdata</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">hhsize</span><span class="op">:</span><span class="va">ethnicity</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Household characteristics"</span>,
                              <span class="fu">str_detect</span><span class="op">(</span><span class="va">term</span>, <span class="st">"(ethnicity|hhsize)"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Household characteristics"</span>,
                              <span class="va">term</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">mdata</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">refrigerator</span><span class="op">:</span><span class="va">tv</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Household assets"</span><span class="op">)</span>,
         category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">category</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Area-level indicators"</span>, <span class="st">"Household characteristics"</span>, <span class="st">"Household assets"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot model coefficients </span>
<span class="va">tidym</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">term</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">conf.low</span>, xmax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">category</span><span class="op">)</span>,
             scales <span class="op">=</span> <span class="st">"free_y"</span>, space <span class="op">=</span> <span class="st">"free_y"</span>,
             labeller <span class="op">=</span> <span class="fu">as_labeller</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">x</span>, <span class="st">" "</span>, <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># convert raw variable names into something more human-readable</span>
  <span class="fu">scale_y_discrete</span><span class="op">(</span>labels <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">case_when</span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="st">"tv"</span> <span class="op">~</span> <span class="st">"TV"</span>,
              <span class="va">x</span> <span class="op">==</span> <span class="st">"washing_machine"</span> <span class="op">~</span> <span class="st">"Washing machine"</span>,
              <span class="va">x</span> <span class="op">==</span> <span class="st">"secure_neighborhood"</span> <span class="op">~</span> <span class="st">"Secure neighborhood"</span>,
              <span class="va">x</span> <span class="op">==</span> <span class="st">"region_Sur"</span> <span class="op">~</span> <span class="st">"Region = Sur"</span>,
              <span class="va">x</span> <span class="op">==</span> <span class="st">"region_Nororiente"</span> <span class="op">~</span> <span class="st">"Region = Nororiente"</span>,
              <span class="va">x</span> <span class="op">==</span> <span class="st">"region_Noroccidente"</span> <span class="op">~</span> <span class="st">"Region = Noroccidente"</span>,
              <span class="va">x</span> <span class="op">==</span> <span class="st">"nchildren"</span> <span class="op">~</span> <span class="st">"Number of children"</span>,
              <span class="va">x</span> <span class="op">==</span> <span class="st">"hhsize_x_nchildren"</span> <span class="op">~</span> <span class="st">"Household size x\n Number of children"</span>,
              <span class="va">x</span> <span class="op">==</span> <span class="st">"hhsize"</span> <span class="op">~</span> <span class="st">"Household size"</span>,
              <span class="va">x</span> <span class="op">==</span> <span class="st">"ethnicity_Ladina"</span> <span class="op">~</span> <span class="st">"Ethnicity = Ladina"</span>,
              <span class="va">x</span> <span class="op">==</span> <span class="st">"ethnicity_Indígena"</span> <span class="op">~</span> <span class="st">"Ethnicity = Indígena"</span>,
              <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu">str_to_sentence</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>,
       title <span class="op">=</span> <span class="st">"PMT Model"</span>,
       subtitle <span class="op">=</span> <span class="st">"Coefficients of model covariates"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_light</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Lato"</span><span class="op">)</span></code></pre></div>
<p><img src="Targeting_files/figure-html/model-1.png" width="660" style="display: block; margin: auto;"></p>
<p>The signs of all coefficients are in line with what’s expected: households in urban areas have higher incomes than those in non-urban areas, and higher average income in a province is similarly correlated with higher household welfare. Likewise, larger households, and households with high numbers of children tend to be poorer on average. Meanwhile, ownership of common household assets and access to basic services (water, sanitation) are consistently indicative of a higher living standard.</p>
<p>Plotting standardized residuals against fitted values could help us detect the presence of heteroskedasticity (i.e., if the variance of residuals is non-constant across the predicted values) which is a violation of the linear regression assumptions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">.fitted</span>, <span class="va">.std.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_smooth</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#0072BC"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Box-Cox transformed predicted household per capita income"</span>,
       y <span class="op">=</span> <span class="st">"Standardized residuals"</span>,
       title <span class="op">=</span> <span class="st">"PMT Model Diagnostics"</span>,
       subtitle <span class="op">=</span> <span class="st">"Residual plot"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Lato"</span><span class="op">)</span></code></pre></div>
<p><img src="Targeting_files/figure-html/resid-plot-1.png" width="660" style="display: block; margin: auto;"></p>
<p>Ideally, the blue line in the above plot should be as close to flat as possible. In our case, we could confirm that the errors are normally distributed.</p>
<p>Another important diagnostic to look at is Cook’s D. The statistic is used to measure the influence of individual observations on the overall model, essentially capturing how much the model’s predicted values would change on average if the respective observation was deleted prior to model fitting. Two commonly used cut-off values for identifying influences are observations with a Cook’s D of &gt;1 or &gt;4/(# of rows in data).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">augment</span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_dotplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">.cooksd</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">.00005</span>, method <span class="op">=</span> <span class="st">"histodot"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">4</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mdata</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">4</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mdata</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">1</span>, label <span class="op">=</span> <span class="st">"Cut-off point"</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Cook's D"</span>, y <span class="op">=</span> <span class="st">"Density"</span>,
      title <span class="op">=</span> <span class="st">"PMT Model Diagnostics"</span>,
      subtitle <span class="op">=</span> <span class="st">"Cook's D"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Lato"</span><span class="op">)</span></code></pre></div>
<p><img src="Targeting_files/figure-html/cookds-plot-1.png" width="660" style="display: block; margin: auto;"></p>
<p>From the above plot we could see that there are a few data points in the dataset that are heavily biasing the predictions of the model. Normally we would explore the characteristics of those points to understand what’s so special about them and how to recode them to lessen their influence on the model, but that won’t be done here given the limited number of options for recoding the already limited covariates entering the model.</p>
</div>
<div id="predictive-performance" class="section level1">
<h1 class="hasAnchor">
<a href="#predictive-performance" class="anchor"></a>Predictive Performance</h1>
<p>Ultimately, any assessment of a PMT model should rest above all on its ability to correctly identify poor households. According to the last official data from 2014, <a href="https://databank.worldbank.org/data/download/poverty/987B9C90-CB9F-4D93-AE8C-750588BF00QA/SM2020/Global_POVEQ_GTM.pdf">almost 60% of the population were living below the national poverty line</a>. Since that figure has not been updated in a long time, we’ll just use the 60th income percentile as a relative poverty line for assessing the performance of the PMT.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract poverty predictions</span>
<span class="va">mdata</span> <span class="op">&lt;-</span> <span class="va">mdata</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>pred_pcinc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">invBoxCox</span><span class="op">(</span>lambda <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">rec</span>, <span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>

<span class="co"># poverty line at 60th percentile of the income distribution</span>
<span class="va">pline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">mdata</span><span class="op">$</span><span class="va">pcinc</span>, <span class="fl">.6</span><span class="op">)</span>
<span class="co"># adjust cut-off threshold to optimize predictive performance</span>
<span class="va">thresh</span> <span class="op">&lt;-</span> <span class="fu">optimum_threshold</span><span class="op">(</span><span class="va">mdata</span>, <span class="va">pcinc</span>, <span class="va">pred_pcinc</span>, <span class="va">pline</span><span class="op">)</span><span class="op">$</span><span class="va">.threshold</span>

<span class="co"># convert continuous per-capita measures to binary poverty indicators</span>
<span class="va">mdata</span> <span class="op">&lt;-</span> <span class="va">mdata</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>poor <span class="op">=</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">pcinc</span> <span class="op">&lt;</span> <span class="va">pline</span><span class="op">)</span>, pred_poor <span class="op">=</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">pred_pcinc</span> <span class="op">&lt;</span> <span class="va">thresh</span><span class="op">)</span><span class="op">)</span>

<span class="co"># label cases that are incorrectly classified</span>
<span class="va">mdata</span> <span class="op">&lt;-</span> 
  <span class="va">mdata</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>class <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">poor</span> <span class="op">!=</span> <span class="st">"TRUE"</span> <span class="op">&amp;</span> <span class="va">pred_poor</span> <span class="op">==</span> <span class="st">"TRUE"</span> <span class="op">~</span> 
                             <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"Inclusion error\n({scales::label_percent(accuracy = .01)(1-spec_vec(mdata$poor, mdata$pred_poor))})"</span><span class="op">)</span>,
                           <span class="va">poor</span> <span class="op">==</span> <span class="st">"TRUE"</span> <span class="op">&amp;</span> <span class="va">pred_poor</span> <span class="op">!=</span> <span class="st">"TRUE"</span> <span class="op">~</span> 
                             <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"Exclusion error\n({scales::label_percent(accuracy = .01)(1-sens_vec(mdata$poor, mdata$pred_poor))})"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot true vs. estimated values</span>
<span class="va">mdata</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">pcinc</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">pred_pcinc</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">pcinc</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">pred_pcinc</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">class</span><span class="op">)</span>, data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">pline</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">thresh</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">thresh</span><span class="op">/</span><span class="va">pline</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#EF4A60"</span>, <span class="st">"#00B398"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"income per capita\nlog(actual)"</span>, y <span class="op">=</span> <span class="st">"income per capita\nlog(predicted)"</span>,
       color <span class="op">=</span> <span class="cn">NULL</span>,
       title <span class="op">=</span> <span class="st">"PMT Model Fit"</span>,
       subtitle <span class="op">=</span> <span class="st">"Actual vs. Predicted"</span>,
       caption <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"R-squared = {round(rsq_vec(mdata$pcinc, mdata$pred_pcinc), 3)}"</span>,
                            <span class="st">"RMSE = {round(rmse_vec(mdata$pcinc, mdata$pred_pcinc), 3)}"</span>,
                            <span class="st">"Accuracy = {scales::label_percent(accuracy = .01)(accuracy_vec(mdata$poor, mdata$pred_poor))}"</span>,
                            .sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Lato"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></code></pre></div>
<p><img src="Targeting_files/figure-html/fit-1.png" width="660" style="display: block; margin: auto;"></p>
<p>As could be seen from the plot, the model exhibits reasonable performance on par with most PMTs employed in governmental social safety nets. A better understanding of the model’s predictive performance could be reached by looking at how inclusion/exclusion errors vary as the cut-off threshold (=poverty line) moves along the spectrum of wealth percentiles.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># prepare a data-frame of performance measures at different cut-off points</span>
<span class="va">tradeoffs</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">mdata</span><span class="op">$</span><span class="va">pcinc</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">map_dfr</span><span class="op">(</span><span class="op">~</span><span class="fu">optimum_threshold</span><span class="op">(</span><span class="va">mdata</span>, <span class="va">pcinc</span>, <span class="va">pred_pcinc</span>, cutoff <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span>

<span class="co"># visualize the alternatives curves</span>
<span class="va">tradeoffs</span> <span class="op">%&gt;%</span> 
  <span class="fu">transmute</span><span class="op">(</span>pcinc_percentile <span class="op">=</span> <span class="fu">percent_rank</span><span class="op">(</span><span class="va">.threshold</span><span class="op">)</span>,
            coverage <span class="op">=</span> <span class="va">sensitivity</span>,
            leakage <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">specificity</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">pcinc_percentile</span>, names_to <span class="op">=</span> <span class="st">"measure"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">pcinc_percentile</span>, <span class="va">value</span>, color <span class="op">=</span> <span class="va">measure</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">.6</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">.6</span>, y <span class="op">=</span> <span class="fl">1</span>, label <span class="op">=</span> <span class="st">"National Poverty Line"</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">.05</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">label_percent</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">label_percent</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_fixed</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"wealth percentile"</span>, y <span class="op">=</span> <span class="st">"% of population"</span>, color <span class="op">=</span> <span class="cn">NULL</span>,
       title <span class="op">=</span> <span class="st">"PMT Model Performance"</span>,
       subtitle <span class="op">=</span> <span class="st">"Across alternative relative poverty lines"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span>base_family <span class="op">=</span> <span class="st">"Lato"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></code></pre></div>
<p><img src="Targeting_files/figure-html/alternatives-1.png" width="660" style="display: block; margin: auto;"></p>
</div>
<div id="discussion" class="section level1">
<h1 class="hasAnchor">
<a href="#discussion" class="anchor"></a>Discussion</h1>
<p>When used to target people living below the national poverty line, the model arrives at the wrong conclusion for 1 in every 5 persons. Lowering the eligibility cut-off line to focus on the poorer quantiles of the population degrades model performance even further. Does that mean that the PMT is not a valid targeting option in this setting? The answer is not so clear-cut. On the one hand, the dataset used for model building lacked sufficient covariates and didn’t allow for the inclusion of demographic variables into the model which greatly restricted its predictive power. Meantime, the choice of linear regression was always going to give better results for households towards the mean of the income distribution rather than those on either tail. If the objective was to target, say, the poorest 20% then alternative modeling techniques (such as quantile regression or up/down-sampling) would’ve given better results. More importantly, while the error margin of the model may be perceived as unusually high, it is better to have a model with a quantifiable error rate (albeit high), than to resort to the common ad hoc targeting approaches for which no error estimates could be meaningfully derived.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Edouard Legoupil, Hisham Galal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
